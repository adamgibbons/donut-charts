<!DOCTYPE html>
<html>
<head>
  <title>Donut Chart</title>
  <!-- Load c3.css -->
  <link href="/node_modules/c3/c3.css" rel="stylesheet">

  <!-- Load d3.js and c3.js -->
  <script src="/node_modules/d3/dist/d3.min.js" charset="utf-8"></script>
  <script src="/node_modules/c3/c3.min.js"></script>  

  <style>
  * {
    font-family: 'helvetica neue', helvetica;
  }
  .legend {
    margin: auto;
    text-align: left;
    width: 150px;
  }

  .legend-block {
    margin: 0.33em 0;
  }

  .legend .color {
    height: 1em;
    width: 1em;
    margin-right: .5em;
    display: inline-block;
  }
  .years {
    display: block;
    margin: 2em;
    text-align: center;
  }
  .year {
    display: inline-block;
    border: 1px solid red;
    padding: 1em;
  }
  </style>
</head>

<body>
  <div class="years">
    <div class="year" data-load>2013</div>
    <div class="year" data-load>2014</div>
    <div class="year" data-load>2015</div>
    <div class="year" data-load>2016</div>
    <div class="year" data-load>2017</div>
  </div>

  <div class="chart-container">
    <div id="chart" style="text-align: center;"></div>
  </div>

  <script>

  var LABELS = [
    'Public Equity',
    'Private Assets',
    'Fixed Income',
    'Cash'
  ]

  var store = {
    '2013': [
      ['publicEquity', 'privateAssets', 'fixedIncome', 'cash'],
      [3, 2, 1, .5]
    ],
    '2014': [
      ['publicEquity', 'privateAssets', 'fixedIncome', 'cash'],
      [1, 2, 3, 8]
    ],
    '2015': [
      ['publicEquity', 'privateAssets', 'fixedIncome', 'cash'],
      [1, 2, 2, 2]
    ],
    '2016': [
      ['publicEquity', 'privateAssets', 'fixedIncome', 'cash'],
      [1, .5, 2, 9]
    ],
    '2017': [
      ['publicEquity', 'privateAssets', 'fixedIncome', 'cash'],
      [2, 4, 1, 7]
    ],
  }

  var chart = c3.generate({
    data: {
      rows: store['2013'],
      type : 'donut',
      onmouseover: function (d, i) { console.log("onmouseover", d, i); },
      onmouseout: function (d, i) { console.log("onmouseout", d, i); }
    },
    transition: {
        duration: 1000
    },
    donut: {
      title: "Asset Allocation",
      expand: false,
      width: 55,
      label: {
        show: false
      }
    },
    tooltip: { show: false },
    color: {
      pattern: [
        '#ca0020',
        '#f4a582',
        '#bababa',
        '#92c5de',
        '#0571b0'
      ]
    },
    legend: {
      show: false
    },
    size: {
      height: 320,
      width: 500
    }
  });

  var blocks = d3.select('.chart-container')
    .insert('div', '.chart')
    .attr('class', 'legend')
    .selectAll()
    .data(LABELS)
  .enter().append('div')
    .attr('class', 'legend-block')
    .attr('data-id', function (id) { return id; })

  // Legend color
  blocks.append('span')
    .attr('class', 'color')
    .each(function (id) {
        d3.select(this).style('background-color', chart.color(id));
    })
  
  // Legend label
  blocks.append('span')
    .html(function (id) { return id; })
    .attr('data-id', function (id) { return id; })
    // .html(function (id) { return id; })

  // blocks.on('mouseover', function (id) {
  //   chart.focus(id);
  // })
  // .on('mouseout', function (id) {
  //     chart.revert();
  // })
  // .on('click', function (id) {
  //     chart.toggle(id);
  // });

  // Year click-handlers
  function loadYear (_, index, element) {
    const year = element[index].textContent

    chart.load({ rows: store[year] })
  }

  d3.selectAll('.year').on('click', loadYear)

  </script>


</body>
</html>